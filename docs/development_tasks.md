# AI辩论测试系统开发任务清单

## 已完成任务

### 1. 项目初始化与配置
- [x] 创建项目基本目录结构
- [x] 配置 TypeScript (tsconfig.json)
- [x] 配置 ESLint 和 Prettier
- [x] 创建 .gitignore 文件
- [x] 创建 README.md 文件
- [x] 配置 package.json
- [x] 安装基础依赖包

### 2. 样式系统
- [x] 创建主题配置 (theme.ts)
- [x] 创建暗色主题 (darkTheme.ts)
- [x] 实现主题切换功能 (ThemeContext.tsx)
- [x] 设置全局样式 (global.css)

### 3. 路由系统
- [x] 配置路由 (routes/index.tsx)
- [x] 创建主应用组件 (App.tsx)

### 4. 通用组件
- [x] Button 组件
- [x] Input 组件
- [x] Modal 组件
- [x] Toast 组件

### 5. 测试界面组件
- [x] DebateRoomLayout 组件（布局）
- [x] PlayerList 组件（AI模型列表）
- [x] MainContent 组件（对话内容）
- [x] ControlPanel 组件（控制面板）
- [x] Header 组件（页面头部）

### 6. 响应式设计优化
- [x] PlayerList 组件响应式布局
- [x] MainContent 组件响应式布局
- [x] DebateRoomLayout 分隔条功能
- [x] 移动端适配

### 7. Dify工作流集成
- [x] 创建Dify应用
  - [x] 配置应用基本信息
  - [x] 设置模型参数
  - [x] 创建提示词模板
- [x] 实现工作流调用
  - [x] API接口封装
  - [x] 错误处理
  - [x] 响应解析
- [x] 多模型支持
  - [x] 模型切换功能
  - [x] 模型参数配置
  - [x] 响应格式统一

## 进行中任务

### 8. 辩论流程管理
#### 8.1 基础流程控制
- [x] 开始/暂停功能实现
  - [x] 创建 `useDebateControl` Hook
  - [x] 实现开始辩论逻辑
  - [x] 实现暂停/继续逻辑
  - [x] 实现结束辩论逻辑
  - [x] 添加状态转换动画

#### 8.3 对话管理
- [x] 发言记录系统
  - [x] 创建 `useSpeechRecorder` Hook
  - [x] 实现发言内容验证
  - [x] 添加发言时间戳
  - [x] 实现发言引用功能
  - [x] 移除发言编辑功能（根据需求调整）

- [ ] 轮次管理系统
  - [ ] 创建 `useRoundControl` Hook
    - [ ] 实现结构化辩论（正反方）模式
    - [ ] 实现自由辩论模式
    - [ ] 轮次切换逻辑
  - [ ] 创建 `useTurnManager` Hook
    - [ ] 发言计时器
    - [ ] 发言顺序控制
    - [ ] 时间警告系统
  - [ ] 创建轮次进度展示组件
    - [ ] 当前轮次/总轮次显示
    - [ ] 发言进度条
    - [ ] 剩余时间显示（不需要显示剩余时间，顺序执行的游戏流程没有时间的概念）
  - [ ] 实现轮次总结功能
    - [ ] 轮次数据统计
    - [ ] 关键点总结
    - [ ] 轮次评分

#### 8.2 辩论模式管理
- [ ] 结构化辩论（正反方）模式
  - [ ] 角色分配系统
    - [ ] 正方/反方角色设置
    - [ ] 固定发言顺序实现
  - [ ] 评分规则设置
    - [ ] 正反方对抗性评分
    - [ ] 论点完整性评分
  - [ ] 结果统计
    - [ ] 正反方得分统计
    - [ ] 胜负判定

- [ ] 自由辩论模式
  - [ ] 抽签系统
    - [ ] 每轮随机顺序生成
    - [ ] 发言顺序展示
  - [ ] 评分规则设置
    - [ ] 观点创新性评分
    - [ ] 论证完整性评分
  - [ ] 结果统计
    - [ ] 个人得分统计
    - [ ] 最佳辩手评选
  - [ ] 淘汰模式
    - [ ] 淘汰规则配置
      - [ ] 启用/禁用淘汰模式
      - [ ] 每轮淘汰人数设置
      - [ ] 最少保留人数设置
      - [ ] 同分处理规则配置
    - [ ] 淘汰机制实现
      - [ ] 轮次结束评分计算
      - [ ] 排名确定算法
      - [ ] 淘汰选手选择
      - [ ] 同分情况处理
    - [ ] 淘汰过程展示
      - [ ] 淘汰公告组件
      - [ ] 存活选手更新
      - [ ] 淘汰历史记录
    - [ ] 胜者确定
      - [ ] 最终胜者判定
      - [ ] 生存轮次统计
      - [ ] 胜利原因分析

#### 8.4 游戏配置界面
- [ ] 开局配置
  - [ ] 创建配置表单组件
  - [ ] 实现辩论模式选择
  - [ ] 实现参与人数设置
  - [ ] 实现角色分配（正反方模式）
  - [ ] 添加配置预览

- [ ] 规则设置
  - [ ] 创建规则编辑器
  - [ ] 实现轮次设置
  - [ ] 实现时间限制设置
  - [ ] 添加规则验证
  - [ ] 实现规则预览

## 待完成任务

### 9. AI裁判系统
- [ ] Dify评分工作流配置
  - [ ] 评分维度设置
    - [ ] 逻辑性评分（论证完整性、推理严谨性）
    - [ ] 人类自然度（降低AI特征明显的表达）
    - [ ] 规则遵守度（字数限制、引用规范等）
    - [ ] 立场一致性（与选手立场的符合度）
    - [ ] 反应能力（对其他选手观点的回应）
  - [ ] 评分工作流提示词模板
  - [ ] 权重配置（0-100%）
- [ ] 评分工作流调用
  - [ ] 发言完成后自动触发评分
  - [ ] 评分数据标准化处理
  - [ ] 加权总分计算
- [ ] 评分结果处理
  - [ ] 评分理由展示
  - [ ] 具体改进建议
  - [ ] 总体评价总结
  - [ ] 评分数据导出

### 10. 数据持久化
- [ ] 浏览器本地存储实现
  - [ ] LocalStorage配置
    - [ ] 存储键定义（playerProfiles/debateHistory/userPreferences/currentDebate）
    - [ ] 存储限制设置（最大存储容量/最大记录数）
    - [ ] 自动清理机制
  - [ ] IndexedDB实现
    - [ ] 数据库结构设计（debates/speeches存储）
    - [ ] 版本控制
    - [ ] 查询优化
- [ ] 数据导出功能
  - [ ] JSON格式导出
    - [ ] 辩论记录导出
    - [ ] 评分数据导出
    - [ ] 配置导出
  - [ ] 自动备份
    - [ ] 定期备份策略
    - [ ] 备份文件管理
    - [ ] 恢复功能

### 11. 系统优化
- [ ] 性能优化
  - [ ] API调用优化
  - [ ] 响应缓存
  - [ ] 加载优化
- [ ] 用户体验
  - [ ] 加载状态
  - [ ] 错误提示
  - [ ] 操作反馈

### 12. 文档
- [ ] 技术文档
  - [ ] API文档
  - [ ] 组件文档
  - [ ] 部署文档
- [ ] 用户指南
  - [ ] 使用说明
  - [ ] 常见问题
  - [ ] 最佳实践

## 问题追踪

### 待解决的问题
1. 需要处理TypeScript编译器关于babel相关类型定义的警告
2. 需要完善错误处理机制
3. 需要添加加载状态处理

### 优化建议
1. 考虑添加组件懒加载
2. 考虑使用性能监控工具
3. 考虑添加错误边界处理
4. 考虑优化API调用频率和成本
5. 考虑添加模型响应缓存机制 