# AI辩论测试系统开发任务清单

## 已完成任务

### 1. 项目初始化与配置
- [x] 创建项目基本目录结构
- [x] 配置 TypeScript (tsconfig.json)
- [x] 配置 ESLint 和 Prettier
- [x] 创建 .gitignore 文件
- [x] 创建 README.md 文件
- [x] 配置 package.json
- [x] 安装基础依赖包

### 2. 样式系统
- [x] 创建主题配置 (theme.ts)
- [x] 创建暗色主题 (darkTheme.ts)
- [x] 实现主题切换功能 (ThemeContext.tsx)
- [x] 设置全局样式 (global.css)

### 3. 路由系统
- [x] 配置路由 (routes/index.tsx)
- [x] 创建主应用组件 (App.tsx)

### 4. 通用组件
- [x] Button 组件
- [x] Input 组件
- [x] Modal 组件
- [x] Toast 组件

### 5. 测试界面组件
- [x] DebateRoomLayout 组件（布局）
- [x] PlayerList 组件（AI模型列表）
- [x] MainContent 组件（对话内容）
- [x] ControlPanel 组件（控制面板）
- [x] Header 组件（页面头部）

### 6. 响应式设计优化
- [x] PlayerList 组件响应式布局
- [x] MainContent 组件响应式布局
- [x] DebateRoomLayout 分隔条功能
- [x] 移动端适配

### 7. Dify工作流集成
- [x] 创建Dify应用
  - [x] 配置应用基本信息
  - [x] 设置模型参数
  - [x] 创建提示词模板
- [x] 实现工作流调用
  - [x] API接口封装
  - [x] 错误处理
  - [x] 响应解析
- [x] 多模型支持
  - [x] 模型切换功能
  - [x] 模型参数配置
  - [x] 响应格式统一

### 8. 辩论流程管理
#### 8.1 基础流程控制
- [x] 开始/暂停功能实现
  - [x] 创建 `useDebateControl` Hook
  - [x] 实现开始辩论逻辑
  - [x] 实现暂停/继续逻辑
  - [x] 实现结束辩论逻辑
  - [x] 添加状态转换动画

#### 8.2 辩论模式管理
- [x] 结构化辩论（正反方）模式
  - [x] 角色分配系统
    - [x] 正方/反方角色设置
    - [x] 固定发言顺序实现
  - [x] 评分规则设置
    - [x] 正反方对抗性评分
    - [x] 论点完整性评分

#### 8.3 对话管理
- [x] 发言记录系统
  - [x] 创建 `useSpeechRecorder` Hook
  - [x] 实现发言内容验证
  - [x] 添加发言时间戳
  - [x] 实现发言引用功能
  - [x] 移除发言编辑功能（根据需求调整）

## 进行中任务

### 8.4 轮次管理系统
- [x] 创建 `useRoundControl` Hook
  - [x] 实现结构化辩论（正反方）模式
  - [x] 实现自由辩论模式
  - [x] 轮次切换逻辑
- [x] 创建 `useTurnManager` Hook
  - [x] 发言计时器
  - [x] 发言顺序控制
  - [x] 时间警告系统
- [x] 创建轮次进度展示组件
  - [x] 当前轮次/总轮次显示
  - [x] 发言进度条
  - [x] 剩余时间显示
- [ ] 实现轮次总结功能
  - [ ] 轮次数据统计
  - [ ] 关键点总结
  - [ ] 轮次评分

### 8.5 淘汰模式
- [x] 淘汰规则配置
  - [x] 启用/禁用淘汰模式
  - [x] 每轮淘汰人数设置
  - [x] 最少保留人数设置
  - [x] 同分处理规则配置
- [x] 淘汰机制实现
  - [x] 轮次结束评分计算
  - [x] 排名确定算法
  - [x] 淘汰选手选择
  - [x] 同分情况处理
- [x] 淘汰过程展示
  - [x] 淘汰公告组件
  - [x] 存活选手更新
  - [x] 淘汰历史记录
- [x] 胜者确定
  - [x] 最终胜者判定
  - [x] 生存轮次统计
  - [x] 胜利原因分析

### 8.6 游戏配置界面
- [x] 开局配置
  - [x] 创建配置表单组件
  - [x] 实现辩论模式选择
  - [x] 实现参与人数设置
  - [x] 实现角色分配（正反方模式）
  - [x] 添加配置预览

### 8.7 主题设置系统
- [ ] 主题配置界面
  - [ ] 创建主题表单组件
  - [ ] 添加主题类型选择
  - [ ] 实现背景资料编辑器
- [ ] 主题规则配置
  - [ ] 添加论点要求设置
  - [ ] 实现论证方式选择
  - [ ] 添加特殊限制配置
- [ ] 安全控制系统
  - [ ] 集成敏感词检查
  - [ ] 添加内容合规性验证
  - [ ] 实现违规提示功能

### 8.8 辩论规则配置
- [ ] 发言规则设置
  - [ ] 添加字数限制配置
  - [ ] 实现发言有效性规则
  - [ ] 添加发言顺序管理
- [ ] 高级规则设置
  - [ ] 实现引用规则配置
  - [ ] 添加反驳规则设置
  - [ ] 实现论证要求配置
  - [ ] 添加角色限制设置

### 8.9 选手管理系统
- [ ] 选手信息管理
  - [ ] 创建基础信息编辑器
  - [ ] 添加头像上传功能
  - [ ] 实现人设配置界面
- [ ] 角色配置
  - [ ] 选手性格设定
  - [ ] 辩论风格配置
  - [ ] 背景故事编辑
  - [ ] 行为准则设置
- [ ] 数据管理功能
  - [ ] 添加导入导出功能
  - [ ] 实现版本控制系统
  - [ ] 开发备份恢复功能

### 8.10 AI大模型管理
- [x] 模型供应商管理
  - [x] 供应商配置
    - [x] OpenAI配置
    - [x] Anthropic配置
    - [x] 其他大模型配置
    第二阶段（核心供应商实现）：
      [x] OpenAI供应商适配器
      [x] Anthropic供应商适配器
      [x] 火山引擎供应商适配器
      [x] Deepseek供应商适配器
        - [x] 创建 DeepseekProvider 类
        - [x] 实现模型配置界面
        - [x] 添加流式输出支持
        - [x] 集成 reasoning_content 功能
        - [x] 实现余额查询功能
        - [x] 添加错误处理机制
      [x] 讯飞星火供应商适配器
      [x] 通义千问供应商适配器
      [x] 文心一言供应商适配器
      [x] 本地模型供应商适配器（Ollama和LocalAI）
        - [x] 创建 OllamaProvider 类
        - [x] 实现模型配置界面
        - [x] 添加流式输出支持
        - [x] 实现本地模型列表获取
        - [x] 添加错误处理机制
      [x] 供应商工厂类实现

    - [x] 本地模型配置
  - [x] 模型参数管理
    - [x] 参数模板定义
    - [x] 默认值配置
    - [x] 参数验证规则
  - [x] API密钥管理
    - [x] 密钥存储加密
    - [x] 密钥有效期管理
    - [x] 密钥轮换机制
  - [x] 数据持久化
    - [x] 本地存储实现
    - [x] 数据验证
    - [x] 版本控制
    - [x] 错误处理
- [x] 统一调用接口
  - [x] 请求格式标准化
  - [x] 响应解析统一
  - [x] 错误处理封装
  - [x] 重试机制实现
- [ ] 监控与优化
  - [ ] 调用统计
  - [ ] 性能分析
  - [ ] 成本控制
  - [ ] 缓存策略

### 8.11 AI角色配置系统
- [x] 基础架构
  - [x] 创建角色配置 Context 和 Provider
  - [x] 实现配置数据的本地存储
  - [x] 创建基础配置组件结构
- [x] 人设配置界面
  - [x] 创建角色信息表单组件
    - [x] 基本信息配置
    - [x] 头像上传/选择
    - [x] 简介编辑器
  - [x] 实现人设配置功能
    - [x] 性格特征选择器
    - [x] 说话风格配置
    - [x] 专业背景设置
    - [x] 价值观选择器
    - [x] 论证风格配置
    - [x] 自定义描述编辑器
  - [x] 添加预设模板功能
    - [x] 常用人设模板
    - [x] 模板导入/导出
    - [x] 模板编辑/保存
- [x] 调用模式配置
  - [x] Dify工作流模式
    - [x] 服务器URL配置
    - [x] API Key管理
    - [x] 工作流参数设置
  - [x] 直接API调用模式
    - [x] 供应商选择
    - [x] 模型参数配置
    - [x] API Key关联
  - [x] 模式切换机制
    - [x] 配置保存
    - [x] 状态迁移
    - [x] 历史记录保持
- [x] 集成与优化
  - [x] 与辩论配置页面整合
  - [x] 实现响应式布局
  - [x] 添加数据验证
  - [x] 优化用户体验
  - [x] 编写使用文档

### 8.12 存储和配置系统
#### Phase 1: 基础设施 (Week 1)
- [x] 类型定义实现
  - [x] 创建基础类型定义
    - [x] StorageConfig 和 StorageService 接口
    - [x] LocalStorageData 和 IndexedDBConfig 类型
    - [x] BackupConfig 和 BackupMeta 类型
  - [x] 创建错误类型定义
    - [x] StorageError 类
    - [x] StorageErrorCodes 常量

- [x] 核心服务实现
  - [x] 创建基础存储服务
    - [x] StorageService 接口
    - [x] LocalStorageService 实现
    - [x] IndexedDBService 实现
  - [x] 实现备份服务
    - [x] BackupService 实现
    - [x] 备份创建和恢复功能
    - [x] 备份验证功能
  - [x] 实现加密服务
    - [x] EncryptionService
    - [x] API密钥加密存储
  - [ ] 实现缓存服务
    - [ ] CacheService
    - [ ] 缓存策略配置

- [ ] 数据库设计与实现
  - [x] 创建 IndexedDB 数据库
    - [x] 设计数据库结构
    - [x] 实现数据库初始化
  - [x] 创建存储表和索引
    - [x] character_profiles 表
    - [x] character_templates 表
    - [x] game_rules 表
    - [x] scoring_templates 表
    - [x] model_configs 表
    - [x] provider_configs 表
    - [x] debate_history 表
  - [x] 实现复合索引
    - [x] model_enabled 索引
    - [x] template_created 索引

#### Phase 2: 核心功能 (Week 2)
- [ ] 状态管理实现
  - [ ] 创建 Pinia Stores
    - [ ] CharacterStore
    - [ ] GameRulesStore
    - [ ] ModelStore
  - [ ] 实现数据同步
    - [ ] 实时状态更新
    - [ ] 乐观更新处理
    - [ ] 错误回滚机制

- [ ] 配置编辑器组件
  - [ ] 角色配置编辑器
    - [ ] 基本信息编辑
    - [ ] 人设配置编辑
    - [ ] 模型关联配置
  - [ ] 游戏规则编辑器
    - [ ] 主题配置
    - [ ] 规则设置
    - [ ] 评分标准配置
  - [ ] 模型配置编辑器
    - [ ] 供应商选择
    - [ ] 模型参数配置
    - [ ] API配置管理

#### Phase 3: 集成 (Week 3)
- [x] 备份管理集成
  - [x] 自动备份机制
    - [x] 定时备份
    - [x] 增量备份
  - [x] 手动备份功能
    - [x] 备份创建
    - [x] 备份恢复
  - [x] 备份验证系统
    - [x] 完整性检查
    - [x] 版本兼容性验证

- [ ] 数据迁移工具
  - [ ] 版本迁移系统
    - [ ] 向上迁移
    - [ ] 向下迁移
    - [ ] 回滚机制
  - [ ] 数据转换器
    - [ ] 格式转换
    - [ ] 数据清理
  - [ ] 迁移验证
    - [ ] 数据完整性检查
    - [ ] 关系完整性验证

#### Phase 4: 优化 (Week 4)
- [ ] 性能优化
  - [ ] 查询优化
    - [ ] 索引使用分析
    - [ ] 查询计划优化
  - [ ] 缓存优化
    - [ ] 缓存策略调整
    - [ ] 缓存失效处理
  - [ ] 批量操作优化
    - [ ] 批处理大小调优
    - [ ] 并发控制

- [ ] 监控与分析
  - [ ] 性能监控
    - [ ] 操作耗时统计
    - [ ] 资源使用监控
  - [ ] 错误追踪
    - [ ] 错误日志收集
    - [ ] 错误分析报告
  - [ ] 使用统计
    - [ ] 操作频率统计
    - [ ] 数据量统计

- [ ] 安全性增强
  - [ ] 数据加密增强
    - [ ] 密钥轮换机制
    - [ ] 加密算法优化
  - [ ] 访问控制
    - [ ] 权限检查
    - [ ] 操作审计
  - [ ] 数据验证增强
    - [ ] 输入验证
    - [ ] 输出过滤

#### 下一步优先任务：

1. 数据验证实现
   - [x] 创建 Zod Schema
     - [x] CharacterProfile 验证器
     - [x] CharacterTemplate 验证器
     - [x] GameRules 验证器
   - [x] 集成验证
     - [x] 存储前验证
     - [x] 读取后验证
     - [x] 错误处理

2. 迁移系统实现
   - [ ] 创建迁移框架
     - [ ] 版本控制
     - [ ] 迁移脚本
     - [ ] 回滚机制
   - [ ] 实现初始迁移
     - [ ] 创建基础表
     - [ ] 设置索引
     - [ ] 添加测试数据

## 待完成任务

### 9. AI裁判系统
- [ ] 裁判角色配置
  - [ ] 评分标准设置
  - [ ] 裁判风格定义
  - [ ] 反馈详细度配置
- [ ] 调用模式配置
  - [ ] Dify工作流模式
    - [ ] 评分工作流配置
    - [ ] 反馈工作流配置
  - [ ] 直接API调用模式
    - [ ] 评分模型选择
    - [ ] 评分提示词配置
- [ ] 评分维度设置
  - [ ] 逻辑性评分（论证完整性、推理严谨性）
  - [ ] 人类自然度（降低AI特征明显的表达）
  - [ ] 规则遵守度（字数限制、引用规范等）
  - [ ] 立场一致性（与选手立场的符合度）
  - [ ] 反应能力（对其他选手观点的回应）
- [ ] 评分流程实现
  - [ ] 发言完成后评分
  - [ ] 评分数据标准化
  - [ ] 加权计算实现
- [ ] 评分结果处理
  - [ ] 评分理由展示
  - [ ] 具体改进建议
  - [ ] 总体评价总结
  - [ ] 评分数据导出

### 10. 数据持久化
- [ ] 浏览器本地存储实现
  - [ ] LocalStorage配置
    - [ ] 存储键定义
    - [ ] 存储限制设置
    - [ ] 自动清理机制
  - [ ] IndexedDB实现
    - [ ] 数据库结构设计
    - [ ] 版本控制
    - [ ] 查询优化
- [ ] 数据导出功能
  - [ ] JSON格式导出
    - [ ] 辩论记录导出
    - [ ] 评分数据导出
    - [ ] 配置导出
  - [ ] 自动备份
    - [ ] 定期备份策略
    - [ ] 备份文件管理
    - [ ] 恢复功能

### 11. 系统优化
- [ ] 性能优化
  - [ ] API调用优化
  - [ ] 响应缓存
  - [ ] 加载优化
- [ ] 用户体验
  - [ ] 加载状态
  - [ ] 错误提示
  - [ ] 操作反馈

### 12. 文档
- [ ] 技术文档
  - [ ] API文档
  - [ ] 组件文档
  - [ ] 部署文档
- [ ] 用户指南
  - [ ] 使用说明
  - [ ] 常见问题
  - [ ] 最佳实践

## 问题追踪

### 待解决的问题
1. 需要处理TypeScript编译器关于babel相关类型定义的警告
2. 需要完善错误处理机制
3. 需要添加加载状态处理

### 优化建议
1. 考虑添加组件懒加载
2. 考虑使用性能监控工具
3. 考虑添加错误边界处理
4. 考虑优化API调用频率和成本
5. 考虑添加模型响应缓存机制 